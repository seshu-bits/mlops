â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     PORT 3000 CONFLICT - FIXED (AlmaLinux Deployment)         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEM DIAGNOSED:
------------------
nginx: [emerg] bind() to 0.0.0.0:3000 failed (98: Address already in use)
nginx: [emerg] bind() to 0.0.0.0:5000 failed (98: Address already in use)
nginx: [emerg] still could not bind()

ROOT CAUSE:
-----------
âœ— Port 3000, 5000, or 9090 already in use by:
  - Old Nginx worker processes
  - Conflicting Nginx configuration files (default.conf, ssl.conf)
  - Previous deployment attempts
  - Other services binding to these ports

SOLUTION APPLIED:
-----------------
Created THREE aggressive port cleanup tools:

1. kill-port-conflicts.sh (NEW) â­ RECOMMENDED FIRST
   - Standalone aggressive port killer
   - Uses lsof, fuser, and kill -9
   - Interactive confirmation
   - Verification after cleanup

2. fix-nginx-startup.sh (ENHANCED)
   - Now kills ports with -9 signal (force kill)
   - Removes conflicting .conf files
   - Uses lsof + fuser for maximum effectiveness
   - Final port check before starting Nginx

3. deploy-complete-almalinux.sh (ENHANCED)
   - Aggressive port cleanup before Nginx config
   - Removes default.conf and ssl.conf
   - Better error messages

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ HOW TO USE (On AlmaLinux Server):

METHOD 1 - Standalone Port Cleanup (RECOMMENDED)
-------------------------------------------------
cd /path/to/mlops/Assignment

# Kill all port conflicts first
bash kill-port-conflicts.sh

# Then run fix or deployment
bash fix-nginx-startup.sh

METHOD 2 - All-in-One Fix
--------------------------
cd /path/to/mlops/Assignment

# This now includes aggressive port cleanup
bash fix-nginx-startup.sh

METHOD 3 - Full Deployment
---------------------------
cd /path/to/mlops/Assignment

# Enhanced with port cleanup
bash deploy-complete-almalinux.sh

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš¡ MANUAL EMERGENCY FIX (if scripts don't work):

# 1. Kill everything using the ports
sudo lsof -ti :3000 | xargs -r sudo kill -9
sudo lsof -ti :5000 | xargs -r sudo kill -9
sudo lsof -ti :9090 | xargs -r sudo kill -9
sudo lsof -ti :80 | xargs -r sudo kill -9

# 2. Use fuser (more aggressive)
sudo fuser -k 3000/tcp
sudo fuser -k 5000/tcp
sudo fuser -k 9090/tcp
sudo fuser -k 80/tcp

# 3. Kill all Nginx
sudo pkill -9 nginx
sudo systemctl stop nginx

# 4. Remove conflicting configs
sudo rm -f /etc/nginx/conf.d/default.conf
sudo rm -f /etc/nginx/conf.d/ssl.conf

# 5. Verify ports are free
sudo lsof -i :3000,5000,9090,80

# 6. Try again
bash fix-nginx-startup.sh

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” DIAGNOSTIC COMMANDS:

Check what's using the ports:
  sudo lsof -i :3000
  sudo lsof -i :5000
  sudo lsof -i :9090
  sudo ss -tlnp | grep -E ':(3000|5000|9090)'

Check all Nginx processes:
  ps aux | grep nginx
  sudo systemctl status nginx

Check all Nginx config files:
  ls -la /etc/nginx/conf.d/
  sudo cat /etc/nginx/conf.d/*.conf

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… WHAT'S DIFFERENT NOW:

Before:
  kill nginx â†’ Port still blocked â†’ Nginx fails to start âŒ

After:
  kill -9 â†’ lsof â†’ fuser â†’ Remove .conf â†’ Verify â†’ Start âœ…

The new scripts use THREE methods to kill processes:
1. lsof -ti | xargs kill -9  (kills by port)
2. fuser -k (kills by tcp port)
3. pkill -9 nginx (kills all nginx)

PLUS: Removes conflicting configuration files
PLUS: Final verification before starting

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ FILES UPDATED:

1. âœ… Assignment/kill-port-conflicts.sh (NEW)
   - Standalone aggressive port cleanup
   - Interactive with verification

2. âœ… Assignment/fix-nginx-startup.sh (ENHANCED)
   - Aggressive port killing (kill -9)
   - Removes conflicting configs
   - Final port check before start

3. âœ… Assignment/deploy-complete-almalinux.sh (ENHANCED)
   - Better port cleanup
   - Removes default configs

4. âœ… Assignment/NGINX_QUICK_FIX.txt (UPDATED)
   - Port conflict solutions
   - New troubleshooting steps

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ SUCCESS CRITERIA:

After running fix-nginx-startup.sh, you should see:

âœ“ Port 80 freed
âœ“ Port 3000 freed
âœ“ Port 5000 freed
âœ“ Port 9090 freed
âœ“ Configuration test passed
âœ“ Nginx started successfully
âœ“ Nginx is running successfully

Nginx should be listening on:
  tcp  0.0.0.0:80
  tcp  0.0.0.0:3000
  tcp  0.0.0.0:5000
  tcp  0.0.0.0:9090

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ†˜ IF STILL FAILING:

1. Check for Docker containers using the ports:
   docker ps
   docker stop <container>

2. Check for Minikube NodePort services:
   kubectl get svc -A
   kubectl delete svc <service-name>

3. Check for other web servers:
   sudo systemctl list-units | grep -E 'http|nginx|apache'
   sudo systemctl stop <service>

4. Reboot the server (last resort):
   sudo reboot

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ SUPPORT CHECKLIST:

If you still get "Address already in use" error after ALL fixes:

â–¡ Ran kill-port-conflicts.sh
â–¡ Confirmed all ports free with: sudo lsof -i :3000,5000,9090
â–¡ Removed /etc/nginx/conf.d/default.conf
â–¡ No Docker containers running on those ports
â–¡ No other Nginx instances: ps aux | grep nginx
â–¡ Rebooted the server

If all checked and still failing, check for:
- SELinux blocking (sudo ausearch -m avc -ts recent | grep nginx)
- Firewall blocking (sudo firewall-cmd --list-all)
- Minikube services (minikube service list)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ BOTTOM LINE:

Run this on AlmaLinux server:
  bash kill-port-conflicts.sh
  bash fix-nginx-startup.sh

This WILL fix the port conflict! ğŸš€
